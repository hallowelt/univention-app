<?php

$wgGroupPermissions["Domain Admins"]["userrights"] = true;
$wgGroupPermissions["Domain Admins"]["statistics"] = true;

$wgGroupPermissions['Domain Admins']['userrights-interwiki'] = true;

//from bsfoundation, config, pm-settings
$wgGroupPermissions['Domain Admins']['block'] = true;
$wgGroupPermissions['Domain Admins']['createaccount'] = true;
$wgGroupPermissions['Domain Admins']['delete'] = true;
$wgGroupPermissions['Domain Admins']['bigdelete'] = true;
$wgGroupPermissions['Domain Admins']['deletedhistory'] = true;
$wgGroupPermissions['Domain Admins']['deletedtext'] = true;
$wgGroupPermissions['Domain Admins']['undelete'] = true;
$wgGroupPermissions['Domain Admins']['editinterface'] = true;
$wgGroupPermissions['Domain Admins']['editusercss'] = true;
$wgGroupPermissions['Domain Admins']['edituserjs'] = true;
$wgGroupPermissions['Domain Admins']['import'] = true;
$wgGroupPermissions['Domain Admins']['importupload'] = true;
$wgGroupPermissions['Domain Admins']['move'] = true;
$wgGroupPermissions['Domain Admins']['move-subpages'] = true;
$wgGroupPermissions['Domain Admins']['move-rootuserpages'] = true;
$wgGroupPermissions['Domain Admins']['move-categorypages'] = true;
$wgGroupPermissions['Domain Admins']['patrol'] = true;
$wgGroupPermissions['Domain Admins']['autopatrol'] = true;
$wgGroupPermissions['Domain Admins']['protect'] = true;
$wgGroupPermissions['Domain Admins']['editprotected'] = true;
$wgGroupPermissions['Domain Admins']['rollback'] = true;
$wgGroupPermissions['Domain Admins']['upload'] = true;
$wgGroupPermissions['Domain Admins']['reupload'] = true;
$wgGroupPermissions['Domain Admins']['reupload-shared'] = true;
$wgGroupPermissions['Domain Admins']['unwatchedpages'] = true;
$wgGroupPermissions['Domain Admins']['autoconfirmed'] = true;
$wgGroupPermissions['Domain Admins']['editsemiprotected'] = true;
$wgGroupPermissions['Domain Admins']['ipblock-exempt'] = true;
$wgGroupPermissions['Domain Admins']['blockemail'] = true;
$wgGroupPermissions['Domain Admins']['markbotedits'] = true;
$wgGroupPermissions['Domain Admins']['apihighlimits'] = true;
$wgGroupPermissions['Domain Admins']['browsearchive'] = true;
$wgGroupPermissions['Domain Admins']['noratelimit'] = true;
$wgGroupPermissions['Domain Admins']['movefile'] = true;
$wgGroupPermissions['Domain Admins']['unblockself'] = true;
$wgGroupPermissions['Domain Admins']['suppressredirect'] = true;
$wgGroupPermissions['Domain Admins']['mergehistory'] = true;
$wgGroupPermissions['Domain Admins']['managechangetags'] = true;
$wgGroupPermissions['Domain Admins']['deletechangetags'] = true;
$wgGroupPermissions['Domain Admins']['dpl_param_update_rules'] = true;
$wgGroupPermissions['Domain Admins']['dpl_param_delete_rules'] = true;
$wgGroupPermissions['Domain Admins']['editwidgets'] = true;
$wgGroupPermissions['Domain Admins']['generatepages'] = true;
$wgGroupPermissions['Domain Admins']['autoreview'] = false;
$wgGroupPermissions['Domain Admins']['stablesettings'] = true;
$wgGroupPermissions['Domain Admins']['movestable'] = true;
$wgGroupPermissions['Domain Admins']['mf-uploadbutton'] = true;
$wgGroupPermissions['Domain Admins']['usermerge'] = true;
$wgGroupPermissions['Domain Admins']['namespace-notifications'] = true;
$wgGroupPermissions['Domain Admins']['replacetext'] = true;
$wgGroupPermissions['Domain Admins']['nuke'] = true;
$wgGroupPermissions['Domain Admins']['readconfirmationremind'] = true;
$wgGroupPermissions['Domain Admins']['editrestrictedfields'] = true;
$wgGroupPermissions['Domain Admins']['review'] = false;
$wgGroupPermissions['Domain Admins']['validate'] = true;
$wgGroupPermissions['Domain Admins']['editcontentmodel'] = true;
$wgGroupPermissions['Domain Admins']['datatransferimport'] = true;
$wgGroupPermissions['Domain Admins']['wikiadmin'] = true;
$wgGroupPermissions['Domain Admins']['smw-admin'] = true;
$wgGroupPermissions['Domain Admins']['remindereditall'] = true;
$wgGroupPermissions['Domain Admins']['expirearticle'] = true;
$wgGroupPermissions['Domain Admins']['groupmanager-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['interwikilinks-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['namespacemanager-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['permissionmanager-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['bluespicepreferences-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['usermanager-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['rssfeeder-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['aboutbluespice-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['blog-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['checklistmodify'] = true;
$wgGroupPermissions['Domain Admins']['dashboards-viewspecialpage-userdashboard'] = true;
$wgGroupPermissions['Domain Admins']['flexiskinedit'] = true;
$wgGroupPermissions['Domain Admins']['flexiskin-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['pageaccess-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['viewfiles'] = true;
$wgGroupPermissions['Domain Admins']['usagetracker-update'] = true;
$wgGroupPermissions['Domain Admins']['readshoutbox'] = true;
$wgGroupPermissions['Domain Admins']['writeshoutbox'] = true;
$wgGroupPermissions['Domain Admins']['archiveshoutbox'] = true;
$wgGroupPermissions['Domain Admins']['pagetemplatesadmin-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['pageassignable'] = true;
$wgGroupPermissions['Domain Admins']['pageassignments'] = true;
$wgGroupPermissions['Domain Admins']['workflowview'] = true;
$wgGroupPermissions['Domain Admins']['workflowedit'] = true;
$wgGroupPermissions['Domain Admins']['workflowlist'] = true;
$wgGroupPermissions['Domain Admins']['viewreaders'] = true;
$wgGroupPermissions['Domain Admins']['searchfiles'] = true;
$wgGroupPermissions['Domain Admins']['extendedsearch-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['extendedsearchadmin-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['universalexport-export'] = true;
$wgGroupPermissions['Domain Admins']['categorymanager-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['edit'] = true;
$wgGroupPermissions['Domain Admins']['read'] = true;
$wgGroupPermissions['Domain Admins']['deleterevision'] = true;
$wgGroupPermissions['Domain Admins']['siteadmin'] = true;
$wgGroupPermissions['Domain Admins']['createpage'] = true;
$wgGroupPermissions['Domain Admins']['right-statistic-viewspecialpage'] = true;
$wgGroupPermissions['Domain Admins']['ratedcommentedit'] = true;
$wgGroupPermissions['Domain Admins']['rating-write'] = true;
$wgGroupPermissions['Domain Admins']['rating-read'] = true;
$wgGroupPermissions['Domain Admins']['rating-archive'] = true;
$wgGroupPermissions['Domain Admins']['rating-viewspecialpage'] = true;

//assignment management
//interwiki links
//page templates
//preferences
//skin
//export

require_once "$IP/extensions/LdapAuthentication/LdapAuthentication.php";

$wgAuth = new LdapAuthenticationPlugin();

//Calculate basedb for ldap from given read only bind user
$arrLdapHostDN = explode(",", getenv( 'LDAP_HOSTDN' ));
$arrBaseDN = [];//dc=7761,dc=hallowelt,dc=intranet
foreach($arrLdapHostDN as $hostDN){
  if(strpos($hostDN, 'dc=') !== false){
    $arrBaseDN[] = $hostDN;
  }
}

$sBaseDN = join(',', $arrBaseDN);

$wgLDAPDomainNames                      = array( getenv('LDAP_MASTER') );
$wgLDAPServerNames                      = array( getenv('LDAP_MASTER') => getenv( 'DB_HOST' ) );
$wgLDAPProxyAgent                       = array( getenv('LDAP_MASTER') => getenv( 'LDAP_HOSTDN' ));
$wgLDAPProxyAgentPassword               = array( getenv('LDAP_MASTER') => file_get_contents( '/etc/machine.secret' ) );
$wgLDAPEncryptionType                   = array( getenv('LDAP_MASTER') => 'clear' );
$wgLDAPSearchAttributes                 = array( getenv('LDAP_MASTER') => 'uid' );
$wgLDAPBaseDNs                          = array( getenv('LDAP_MASTER') => $sBaseDN );
$wgLDAPPreferences                      = array( getenv('LDAP_MASTER') => array( 'email' => 'mail','realname' => 'displayname','nickname' => 'samaccountname' ) );
$wgLDAPGroupUseFullDN                   = array( getenv('LDAP_MASTER') => true );
$wgLDAPGroupSearchNestedGroups          = array( getenv('LDAP_MASTER') => true );
$wgLDAPGroupObjectclass                 = array( getenv('LDAP_MASTER') => "univentionGroup" );
$wgLDAPGroupAttribute                   = array( getenv('LDAP_MASTER') => "uniqueMember" );
$wgLDAPGroupNameAttribute               = array( getenv('LDAP_MASTER') => "cn" );
$wgLDAPGroupUseRetrievedUsername        = array( getenv('LDAP_MASTER') => false );
$wgLDAPLowerCaseUsername                = array( getenv('LDAP_MASTER') => true );
$wgLDAPUseLDAPGroups                    = array( getenv('LDAP_MASTER') => true );
$wgLDAPUseLocal                         = array( getenv('LDAP_MASTER') => false );
$wgLDAPRequiredGroups                   = array( getenv('LDAP_MASTER') => array( ) );
$wgLDAPAuthAttribute                    = array( getenv('LDAP_MASTER') => 'bluespiceActivated=TRUE' );

//$wgLDAPDebug                            = 3;
//$wgDebugLogGroups['ldap']               = '/tmp/bluespice_ldap.log';
